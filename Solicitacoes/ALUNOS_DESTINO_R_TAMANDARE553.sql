
/*
por favor, precisamos do arquivo dos endereços das crianças matriculadas na 
CEI RUACH, COD EOL 309296 e a distância para o endereço Rua Tamandaré n.º 553,
Liberdade  -23.56365359437513, -46.634749361931206
*/

DROP TABLE ##ALUNOS_DESTINO_R_TAMANDARE553
SELECT DRE,A.CD_ESCOLA,SG_TP_ESCOLA,NOMESC,SG_ETAPA,C.SG_SERIE_ENSINO,COD_ALUNO,NM_ALUNO,
CONCAT(TP_LOGRADOURO,' ',ENDEREÇO,', ',A.NR,' ',A.COMPL,' ',A.BAIRRO) AS ENDERECO_ALUNO,
'Rua Tamandaré, 553' AS DESTINO,
FLOOR(FLOOR(SQRT(POWER((LAT_ALUNO * 1000000 - (-23.56365359437513 * 1000000) ),2) +  
				 POWER((LON_ALUNO * 1000000 - (-46.634749361931206 * 1000000)),2)) / 10)/0.6) AS DIST_DESTINO,
A.CRDATE
INTO ##ALUNOS_DESTINO_R_TAMANDARE553
 FROM VW_ALUNOS_ENDERECOS A
 JOIN SME_ESCOLA_DIARIO B ON A.cd_escola=B.CD_ESCOLA
 JOIN SME_ALUNOS_DIARIO C ON A.COD_ALUNO=C.CD_ALUNO
 
 WHERE A.cd_escola = 309296
 
 SG_ETAPA LIKE '%INF%'
 AND FLOOR(FLOOR(SQRT(POWER((LAT_ALUNO * 1000000 - (-23.56365359437513 * 1000000) ),2) +  
				 POWER((LON_ALUNO * 1000000 - (-46.634749361931206 * 1000000)),2)) / 10)/0.6) <=5000

--SELECT * FROM ##ALUNOS_DESTINO_R_TAMANDARE553


select top 10 * from VW_ALUNOS_ENDERECOS

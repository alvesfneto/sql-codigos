
DROP TABLE ##LISTA_DESTINO
SELECT 

CONCAT(A.SG_TP_ESCOLA,A.NOME_ESCOLA) AS ORIGEM,
A.ETAPA,
A.SERIE_ANO,
A.COD_ALUNO,
A.NOME_ALUNO,


B.CD_ESCOLA,B.SG_TP_ESCOLA, B.NOMESC,
FLOOR(FLOOR(SQRT(POWER((LAT_ALUNO * 1000000 - (B.CD_COORDENADA_GEO_Y * 1000000) ),2) +  
				 POWER((LON_ALUNO * 1000000 - (B.CD_COORDENADA_GEO_X * 1000000)),2)) / 10)/0.6) AS DIST
INTO ##LISTA_DESTINO
FROM TBL_ENDERECOS_ALUNOS A, SME_ESCOLA_DIARIO B
WHERE B.CD_ESCOLA <> 308799 AND A.CD_ESCOLA=308799 AND B.TP_ESCOLA IN (10,11,12,18,28,31)
AND FLOOR(SQRT(POWER((LAT_ALUNO * 1000000 - (B.CD_COORDENADA_GEO_Y * 1000000) ),2) +  
				 POWER((LON_ALUNO * 1000000 - (B.CD_COORDENADA_GEO_X * 1000000)),2)) / 10)/0.6 <=2000

--SELECT * FROM ##LISTA_DESTINO

-------------------------------------------------------------------------------------------------------------------------

--SELECT TOP 10 * FROM TBL_ENDERECOS_ALUNOS

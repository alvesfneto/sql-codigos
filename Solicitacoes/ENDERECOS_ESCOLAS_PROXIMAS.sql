

SELECT 

A.*, 
B.CD_ESCOLA,B.SG_TP_ESCOLA, B.NOMESC,
FLOOR(SQRT(POWER((LAT_ALUNO * 1000000 - (LAT * 1000000) ),2) +  
				 POWER((LON_ALUNO * 1000000 - (LON * 1000000)),2)) / 10)/0.6 AS DIST

FROM TBL_ENDERECOS_ALUNOS A
JOIN (SELECT 
	  DRE,
	  CD_ESCOLA,
	  SG_TP_ESCOLA,
	  NOMESC,
	  ENDERECO,
	  NR,
	  CD_COORDENADA_GEO_Y AS LAT,
	  CD_COORDENADA_GEO_X AS LON
	  FROM SME_ESCOLA_DIARIO
	  WHERE CD_SIT=1 AND TP_ESCOLA IN(10,11,12,18,28,31)) B ON A.CD_ESCOLA=B.CD_ESCOLA

WHERE A.CD_ESCOLA IN (309086,309771,308354,309594,400319,309360,309212,309481,309596,309296)
AND FLOOR(SQRT(POWER((LAT_ALUNO * 1000000 - (LAT * 1000000) ),2) +  
				 POWER((LON_ALUNO * 1000000 - (LON * 1000000)),2)) / 10)/0.6 <=1500


--SELECT * FROM D_TIPO_ESCOLA

--SELECT TOP 10 * FROM TBL_ENDERECOS_ALUNOS

SELECT * FROM SME_ESCOLA_DIARIO WHERE NOMESC LIKE '%CLAUDIO HUM%'

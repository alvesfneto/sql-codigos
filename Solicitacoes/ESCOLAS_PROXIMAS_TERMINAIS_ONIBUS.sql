


/*
SELECT * FROM TAB_END

DELETE TAB_END

INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	1. Terminal Jardim Britânia - Endereço: Av. Pierre Renoir, 95 - Jardim Britânia, São Paulo - SP, 05269-000	 '	 ,	-23.431783465281672	,	-46.787118333276815	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	2. Terminal Pirituba - Endereço: Av. Dr. Felipe Pinel, 60 - Jardim Cidade Pirituba, São Paulo - SP, 02939-000	 '	 ,	-23.48563036961945	,	-46.72628383309379	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	3. Terminal Casa Verde - Endereço: R. Baía Formosa, 80 - Vila Bandeirantes, São Paulo – SP, 02552-120	 '	 ,	-23.495830709645794	,	-46.66242929841464	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	4. Terminal Vila Nova Cachoeirinha - Endereço: Avenida Inajar de Souza, s/n°, Cachoeirinha, São Paulo - SP, 02861-190, Brasil.	 '	 ,	-23.47422380300278	,	-46.669972917443	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	5. Terminal A. E. Carvalho - Endereço: Av. Imperador, 1.401 - Cidade A. E. Carvalho, São Paulo – SP, 08050-000	 '	 ,	-23.518005945222875	,	-46.475693283367015	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	6. Terminal Aricanduva - Endereço: Av. Airton Pretini, 86 - Jardim América da Penha, São Paulo - SP, 03090-000	 '	 ,	-23.528312257905384	,	-46.55460777326754	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	7. Terminal Penha - Endereço: Av. Cangaiba, 31 – Penha, São Paulo	 '	 ,	-23.518835545352385	,	-46.546639315597915	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	8. Terminal São Miguel - Endereço: R. Tarde de Maio - Vila Curuca, São Paulo - SP, 08022-550	 '	 ,	-23.491483994298733	,	-46.43468635792866	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	9. Terminal Cidade Tiradentes - Endereço: R. Sara Kubitscheck, 165 - Cidade Tiradentes, São Paulo - SP, 08474-000	 '	 ,	-23.58296180318195	,	-46.406982659771245	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	10. Terminal Itaquera II - Endereço: Avenida Dr. Luís Aires, s/n°	 '	 ,	-23.54184459849669	,	-46.471105602240634	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	11. Terminal Vila Carrão - Endereço: Av. Dezenove de Janeiro, 884 - Vila Formosa, São Paulo - SP, 03449-000	 '	 ,	-23.557907417993956	,	-46.52263032724837	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	12. Terminal Metropolitano São Mateus - Endereço: Avenida Adélia Chohfi, s/n°, São Mateus, São Paulo – SP	 '	 ,	-23.6131357912988	,	-46.47640234627557	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	13. Terminal Sacomã - Endereço: R. Bom Pastor, 3000 – Ipiranga, São Paulo - SP, 04203-003	 '	 ,	-23.60299599812983	,	-46.60252856773338	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	14. Terminal Sapopemba/Teotônio Vilela - Endereço: Av. Arquiteto Vilanova Artigas – Sapopemba, São Paulo - SP, 03928-240	 '	 ,	-23.61340270950072	,	-46.50099678919553	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	15. Terminal Grajaú - Endereço: Rua Giovanni Bononcini, 77 - Parque Brasil, São Paulo - SP, 04843-020	 '	 ,	-23.736072395348533	,	-46.69655074258471	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	16. Terminal Parelheiros - Endereço: Estrada da Colônia, 300 – Parelheiros, São Paulo - SP	 '	 ,	-23.827901698997564	,	 -46.727053503151986	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	17. Terminal Varginha - Endereço: Av. Paulo Guilguer Reimberg, 247 - Jardim Maria Fernandes, São Paulo - SP, 04858-570	 '	 ,	-23.766784510723422	,	-46.71629000209829	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	18. Terminal Água Espraiada - Endereço: Av. Jornalista Roberto Marinho, 700 - Cidade Monções, São Paulo - SP, 04606-000	 '	 ,	-23.613452866243104	,	 -46.695364900256585	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	19. Terminal Capelinha - Endereço: Estr. de Itapecerica, 3222 - Vila Maracana, São Paulo - SP, 05835-005	 '	 ,	-23.65411879068816	,	 -46.76220171559551	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	20. Terminal Guarapiranga - Endereço: Estrada do M Boi Mirim, 150 - Jardim das Flores, São Paulo - SP, 04905-020	 '	 ,	-23.668728230737553	,	 -46.735533082778915	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	21. Terminal Jardim Ângela - Endereço: Estrada do M Boi Mirim, 4901 - Jardim Angela, São Paulo - SP, 04948-030	 '	 ,	-23.688735242893607	,	-46.773692296408385	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	22. Terminal João Dias - Endereço: Av. João Dias, 3589 - Vila Andrade, São Paulo - SP, 05801-000	 '	 ,	-23.64356772282942	,	-46.734410226413615	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	23. Terminal Santo Amaro - Endereço: Av. Padre José Maria, 400 - Santo Amaro, São Paulo - SP, 04753-060	 '	 ,	-23.654051867863384	,	 -46.71149838948254	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	24. Terminal Campo Limpo - Endereço: Estrada do Campo Limpo, 3465 - Campo Limpo, São Paulo – SP	 '	 ,	-23.630399367084628	,	-46.772825496469544	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	25. Terminal Amaral Gurgel - Endereço: R. Dr. Frederico Steidel, 107 - Santa Cecilia, São Paulo - SP, 01225-030	 '	 ,	-23.54035122150584	,	 -46.6474228155976	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	26. Terminal Bandeira - Endereço: Praça da Bandeira, s/n°, Bela Vista	 '	 ,	-23.549235066872576	,	-46.639621002102	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	27. Terminal Lapa - Endereço: Praça Miguel Dell Erba, 50 – Lapa, São Paulo - SP, 05033-060	 '	 ,	-23.51977518468477	,	-46.70002708676298	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	28. Terminal Mercado - Endereço: Av do Estado, 3350 – Mooca, São Paulo - SP, 01025-020	 '	 ,	-23.547074262670655	,	-46.62915145977208	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	29. Terminal Parque Dom Pedro II - Endereço: Av. do Exterior, s/nº - Sé	 '	 ,	-23.547052781720144	,	-46.62999073093676	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	30. Terminal Pinheiros - Endereço: R. Gilberto Sabino, 130 – Pinheiros, São Paulo - SP, 05425-020	 '	 ,	-23.566445324396934	,	-46.70138988676227	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	31. Terminal Princesa Isabel - Endereço: Alameda Glete, 433 - Campos Elíseos, São Paulo - SP, 01215-000	 '	 ,	-23.53414979247728	,	-46.64470187326736	)
INSERT INTO TAB_END (ENDERECO, LAT, LON) VALUES ('	32. Terminal Vila Prudente - Endereço: Av. Professor Luiz Ignácio Anhaia Mello, 1359 - Vila Prudente, São Paulo - SP, 03155-000	 '	 ,	-23.584335619319415	,	-46.58191418244412	)


SELECT * INTO TAB_END_TERMINAIS FROM TAB_END

*/
--------------------------------------------------------------------------------------
DROP TABLE ##ESCOLAS_PROXIMAS_TERMINAIS
SELECT 
A.ENDERECO,
DRE,
CD_ESCOLA,
SG_TP_ESCOLA,
NOMESC,


(FLOOR(SQRT(POWER((CD_COORDENADA_GEO_X *1000000 - (A.LON * 1000000) ),2) +  POWER((CD_COORDENADA_GEO_Y * 1000000 - (A.LAT * 1000000)),2)) / 10)/0.6) AS DISTÂNCIA
INTO ##ESCOLAS_PROXIMAS_TERMINAIS
FROM TAB_END_TERMINAIS A, SME_ESCOLA_DIARIO B

WHERE (FLOOR(SQRT(POWER((CD_COORDENADA_GEO_X * 1000000 - (A.LON * 1000000) ),2) +  POWER((CD_COORDENADA_GEO_Y * 1000000 - (A.LAT * 1000000)),2)) / 10)/0.6)<=2000
     AND TP_ESCOLA IN (2,4,10,11,12,17,18,28,31) AND CD_SIT=1
--SELECT * FROM ##ESCOLAS_PROXIMAS_TERMINAIS

--Solicitamos a elaboração de arquivo com a distância até 1,5 Km, dos alunos matriculados 
--na CR.P.CONV - ABRINDO O SABER - 308354, para as creches abaixo relacionadas:
--
--CR.P.CONV - Amizade Brasil e China - 309510
--CR.P.CONV - Jericó - 306871
--CR.P.CONV - Coração de Jesus - 306407
--CEI. INDIR. - Bom Retiro - 400510
--CEI. INDIR. - Campos Elíseos - 400725
--CEI. INDIR. - Coração de Maria - 306641
--CEI. INDIR. - Nova Luz - 309543
--CEI. INDIR. - Raphaela Capellano Dias - 400420
--CR.P.CONV - Claret - 306406
--CR.P.CONV - Educador Paulo Freire - 309086
--CR.P.CONV - Mundo Feliz - 309485
--CR.P.CONV - Pacaembu - 306870
--CR.P.CONV - Pinocchio III - 308546
--CR.P.CONV - Pinocchio IV - 308799. 
/*
SELECT 
DRE,
CD_ESCOLA,
SG_TP_ESCOLA,
NOMESC,
CD_COORDENADA_GEO_Y AS LAT_ESCOLA,
CD_COORDENADA_GEO_X AS LON_ESCOLA
--INTO ##ESCOLAS_DESTINO
FROM SME_ESCOLA_DIARIO WHERE CD_ESCOLA IN (309510,306871,306407,400510,400725,306641,309543,400420,306406,309086,309485,306870,308546,308799)
*/
---------------------------------------------------------------------------------------------------------------------------
SELECT 
DRE,
CD_ESCOLA,
SG_TP_ESCOLA,
NOME_ESCOLA,
ETAPA,
SERIE_ANO,
COD_ALUNO,
NOME_ALUNO,
CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.656084 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.541049 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.656084 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.541049 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_306406,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.644079 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.533192 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.644079 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.533192 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_306407,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.659098 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.533403 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.659098 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.533403 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_306641,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.661573 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.533168 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.661573 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.533168 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_306870,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.652462 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.530545 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.652462 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.530545 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_306871,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.651053 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.538114 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.651053 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.538114 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_308546,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.661842 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.534280 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.661842 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.534280 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_308799,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.646674 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.534326 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.646674 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.534326 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_309086,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.660035 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.529564 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.660035 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.529564 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_309485,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.651271 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.531781 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.651271 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.531781 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_309510,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.642007 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.533577 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.642007 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.533577 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_309543,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.656432 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.523970 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.656432 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.523970 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_400420,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.650966 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.523264 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.650966 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.523264 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_400510,

CASE WHEN (SQRT(POWER((LON_ALUNO*1000000- (-46.645346 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.529765 * 1000000)),2)) / 10)/0.6<=1500
THEN
(FLOOR(SQRT(POWER((LON_ALUNO*1000000- (-46.645346 * 1000000) ),2) +  POWER((LAT_ALUNO*1000000  - (-23.529765 * 1000000)),2)) / 10)/0.6)
ELSE NULL END AS DIST_400725
INTO ##DISTANCIA_POSSIVEIS_DESTINOS
FROM TBL_ENDERECOS_ALUNOS

WHERE CD_ESCOLA = 308354


---------------------------------------------------------------------------------------------------





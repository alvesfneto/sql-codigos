--LISTA DE ESCOLAS PRÓXIMAS À ALAMEDA DINO BUENO, 185 - LICEU (ATÉ 3000 METROS)
DROP TABLE ##ESCOLAS_PROXIMAS_LICEU
SELECT 
DRE,
REDE,
CD_ESCOLA,
SG_TP_ESCOLA,
NOMESC,
ENDERECO,
NR,
COMPL,
BAIRRO,
DISTR,
CD_COORDENADA_GEO_Y AS LAT_ESCOLA,
CD_COORDENADA_GEO_X AS LON_ESCOLA,
'Alaneda Dino Bueno, 285' AS END_LICEU,
'-23531868' AS LAT_LICEU,
'-46643186' AS LON_LICEU,

FLOOR(FLOOR(SQRT(POWER((CD_COORDENADA_GEO_Y*1000000) - (-23531868 ),2) +  POWER(CD_COORDENADA_GEO_X*1000000  - (-46643186),2)) / 10)/0.6) AS DIST_ESCOLA_LICEU,
CONVERT(VARCHAR, CRDATE-1,103) AS DT_BASE
--INTO ##ESCOLAS_PROXIMAS_LICEU
FROM SME_ESCOLA_DIARIO 
WHERE 
CD_SIT=1 AND 
TP_ESCOLA IN(1,2,3,4,10,11,12,13,14,15,16,17,18,28,30,31)
AND FLOOR(FLOOR(SQRT(POWER((CD_COORDENADA_GEO_Y*1000000) - (-23531868 ),2) +  POWER(CD_COORDENADA_GEO_X*1000000  - (-46643186),2)) / 10)/0.6)<=600
--SELECT * FROM ##ESCOLAS_PROXIMAS_LICEU
---------------------------------------------------------------------------------------------------------
--=======================================================================================================
---------------------------------------------------------------------------------------------------------
/*estudantes com matrícula ativa para 2023 na Educação Infantil pré-escola e 
Ensino Fundamental de 1º ao 5º ano, que residam num até 4km 
do endereço Alameda Dino Bueno, 285
*/
DROP TABLE ##ALUNOS_DISTANCIA_ATE_4K_LICEU_FUND1_INFANTIL
SELECT  
ANO_LETIVO,
DRE,
CD_ESCOLA,
SG_TP_ESCOLA,
NOME_ESCOLA,
ETAPA,
SERIE_ANO,
COD_ALUNO,
NOME_ALUNO,
TP_LOGRADOURO,
ENDEREÇO,
NR,
COMPL,
BAIRRO,
CEP,
LAT_ALUNO,
LON_ALUNO,
FLOOR(DIST_ALU_ESCOLA) AS DIST_ALU_ESCOLA,
'Alaneda Dino Bueno, 285' AS END_LICEU,
'-23531868' AS LAT_LICEU,
'-46643186' AS LON_LICEU,
FLOOR(FLOOR(SQRT(POWER((LAT_ALUNO*1000000) - (-23531868 ),2) +  POWER(LON_ALUNO*1000000  - (-46643186),2)) / 10)/0.6) AS DIST_ALUNO_LICEU,
CRDATE
INTO ##ALUNOS_DISTANCIA_ATE_4K_LICEU_FUND1_INFANTIL
FROM TBL_ENDERECOS_ALUNOS_2023
WHERE 
ETAPA IN ( 'ENS FUND9A','ED INF') AND SERIE_ANO IN ('1º ANO', '2º ANO','3º ANO','4º ANO','5º ANO','INFANTIL UNIFICADO')
AND FLOOR(FLOOR(SQRT(POWER((LAT_ALUNO*1000000) - (-23531868 ),2) +  POWER(LON_ALUNO*1000000  - (-46643186),2)) / 10)/0.6)<=4000
--SELECT * FROM ##ALUNOS_DISTANCIA_ATE_4K_LICEU_FUND1_INFANTIL
--------------------------------------------------------------------------------------------------------------------------------
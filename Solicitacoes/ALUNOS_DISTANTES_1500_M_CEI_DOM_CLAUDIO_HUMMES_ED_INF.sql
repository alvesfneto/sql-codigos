
/*Por gentileza, solicitamos uma planilha com os alunos matriculados 
na faixa etária de Infantil  (01/04/2017 a 31/03/2019) 
que residam até 1,5 km da Avenida Antônio Ramiro da Silva, s/n (Distrito /setor Rio Pequeno 6702).
A planilha precisa conter nome do aluno, filiação, data de nascimento, endereço completo, 
contato, km do seu endereço até o CEI Dom Claudio Hummes (Avenida Antônio Ramiro da Silva, s/n).
*/
DROP TABLE ##ALUNOS_DISTANTES_1500_M_CEI_DOM_CLAUDIO_HUMMES_ED_INF
SELECT DISTINCT
A.DRE,
A.CD_ESCOLA,
A.SG_TP_ESCOLA,
A.NOME_ESCOLA,
A.ETAPA,
A.SERIE_ANO,
A.COD_ALUNO,
A.NOME_ALUNO,
A.MÃE_ALUNO,
A.RESPONSÁVEL,
CONCAT(TP_LOGRADOURO,ENDEREÇO,',',NR,COMPL,BAIRRO) AS END_ALUNO,
A.DDD,
A.TEL_CELULAR,
A.TEL_FIXO,
A.EMAIL_RESPONSAVEL,
CONVERT(VARCHAR,B.DT_NASCIMENTO_ALUNO,103) AS DT_NASC,
FLOOR(FLOOR(SQRT(POWER((LAT_ALUNO * 1000000 - (-23.579476 * 1000000) ),2) +  
		   POWER((LON_ALUNO * 1000000 - (-46.775634 * 1000000)),2))/10)/0.6) AS DISTANCIA,
A.CRDATE

INTO ##ALUNOS_DISTANTES_1500_M_CEI_DOM_CLAUDIO_HUMMES_ED_INF
FROM VW_ENDERECOS_ALUNOS_COM_RESPONSAVEIS A
JOIN SME_ALUNOS_DIARIO B ON A.COD_ALUNO=B.CD_ALUNO
WHERE DT_NASCIMENTO_ALUNO BETWEEN '2017-04-01' AND '2019-03-31'
AND FLOOR(SQRT(POWER((LAT_ALUNO * 1000000 - (-23.579476 * 1000000) ),2) +  
				 POWER((LON_ALUNO * 1000000 - (-46.775634 * 1000000)),2)) / 10)/0.6<=1500
AND ETAPA='ED INF'


--SELECT * FROM ##ALUNOS_DISTANTES_1500_M_CEI_DOM_CLAUDIO_HUMMES_ED_INF
